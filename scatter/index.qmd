---
# omit title and subtitle if you're doing a custom title block
title: Untitled
subtitle: A thing here
# for social previews
twitter-card:
  site: "@360info_global"
  image: "/folder/example.png"
open-graph:
  image: "/folder/example.png"
resources:
  - example.png
format:
  360-embed-html:
    pagetitle: Untitled
    description: A description for social previews
# metadata for modals and embed sharing functionality
360embed:
  byline: James Goldie, 360info
  data-source: XXX
  type: map
  aspect-ratio: 20 / 19
  min-height: 500px
  max-height: 893px
  bg-colour: white
  title: "Interactive: title"
  repo: report-example
  domain: https://climatereadinessvulnerability.360visuals.org
  path: /map/  
  fragments: state, month
  about: |
    Here's a place to **tell people** and [link to things](https://example.com)!
---

{{< include _popups/_buttons.qmd >}}


```{ojs}
//| label: load-data
ndgain = FileAttachment("/data/ndgain-readiness-vulnerability-allyears.csv")
  .csv({ typed: true })
```

```{ojs}
//| label: controls
viewof selectedYear = Inputs.range(
  [
    Math.min(...ndgain.map(d => d.year)),
    Math.max(...ndgain.map(d => d.year))
  ], {
    value: Math.max(...ndgain.map(d => d.year)),
    label: "Year",
    step: 1
  }
)
```

```{ojs}
//| label: filter-data
filteredData = ndgain.filter(d => d.year == selectedYear)
```

```{ojs}
//| label: plot
Plot = import("https://esm.run/@observablehq/plot@0.6.13")

Plot.plot({
  marks: [
    Plot.ruleX([0.45]),
    Plot.ruleY([0.45]),
    Plot.dot(filteredData, {
      x: "readiness",
      y: "vulnerability",
      r: 9.25,
      fill: "black"
    }),
    Plot.image(filteredData, {
      src: d => "/data/flags/" + d.iso2 + ".svg",
      x: "readiness",
      y: "vulnerability",
      r: 8
    }),
    Plot.text(filteredData, {
      text: "iso3",
      x: "readiness",
      y: "vulnerability",
      dy: 20,
      opacity: 0.25
    }),
    // hovered point
    Plot.dot(filteredData, Plot.pointer({
      x: "readiness",
      y: "vulnerability",
      r: 16.25,
      fill: "black"
    })),
    Plot.image(filteredData, Plot.pointer({
      src: d => "/data/flags/" + d.iso2 + ".svg",
      x: "readiness",
      y: "vulnerability",
      r: 15
    })),
    Plot.tip(filteredData, Plot.pointer({
      x: "readiness",
      y: "vulnerability",
      channels: {
        "Country": {
          label: "",
          value: "name"
        },
        "Readiness": "readiness",
        "Vulnerability": "vulnerability"
      },
      format: {
        "x": null,
        "y": null
      },
      lineHeight: 1.25
    }))
  ],
  style: {
    fontSize: 14,
    fontFamily: "Roboto Condensed"
  },
  height: 550,
  insetLeft: 20,
  insetRight: 20,
  insetBottom: 20,
  marginBottom: 40
})
```

{{< include _popups/_dialogs.qmd >}}
